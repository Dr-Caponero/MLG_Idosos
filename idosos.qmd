---
title: "Caducidade em Idosos"
author: "Camille Menezes, Jeff Caponero e Michel Miler"
format:
    pdf:
      toc: true
      toc-title: Sumário
      colorlinks: true
      documentclass: report
      papersize: letter
      number-sections: false
      geometry:
        - top=30mm
        - left=30mm
        - right=20mm
        - bottom=20mm
        - heightrounded
      fig-pos: "H"
      fig-align: center
      lang: pt-BR
      # fontfamily: libertinus
      fontsize: 12pt
      include-in-header:
      - text: |
          \usepackage{caption}
          \usepackage{fontspec}
          \usepackage{xcolor}
          \usepackage{indentfirst}
          \captionsetup[table]{name=Tabela}
---

```{r pacotes&dados}
#| echo: false
#| warning: false

library(pacman)

pacman::p_load(tidyverse,  readit, summarytools,
               kableExtra, moYments, ggpubr, formattable, gridExtra, 
               glue, corrplot, sessioninfo, readxl, writexl, ggthemes,
               patchwork,  plotly, gglm, ggplot2, tidymodels)

dados <- read_excel("idosos.xlsx")
dados$resp <- as.factor(dados$resp)
dados2 <- NULL
Com <- dados |> filter(resp==1)
Sem <- dados |> filter(resp==0)
```

## Introdução 

Cinquenta e quatro indivíduos considerados idosos são submetidos a um exame psiquiátrico para avaliar a ocorrência ou não de sintoma de caduquice. (Agresti, 1990, pgs. 122-123).
Acredita-se que o escore obtido num exame psicológico feito previamente esteja associado com
a ocorrência ou não do sintoma. Este trabalho propõe um modelo de regressão logística para estudar
esta relação. 


## Análise descritiva
Conduziu-se uma análise descritiva dos dados, com objetivo de entender um pouco mais as variáveis consideradas. A tabela 1 apresenta os resultados obtidos.

```{r}
#| echo: false
#| warning: false
#| mensage: false

tab_com <- Com|>
   summarytools::descr(
    stats = c("min", "q1", "med", "mean","q3", "max",  "sd", "cv", "Skewness", "Kurtosis"),
    justify = "c",
    style = "rmarkdown",
    transpose = T)
tab_sem <- Sem|>
   summarytools::descr(
    stats = c("min", "q1", "med", "mean","q3", "max",  "sd", "cv", "Skewness", "Kurtosis"),
    justify = "c",
    style = "rmarkdown",
    transpose = T)

tab <- rbind(tab_com,tab_sem)
rownames(tab) <- c("Com Caducância", "Sem Caducância")
tab|>
    kbl(
    caption = "Medidas resumo da variável score",
    digits = 2,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", row.names = T, booktabs = T
  )|>
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "scale_down", "repeat_header")
  )|>
  column_spec(1, bold = T
              )|>
  kable_material()

```

Nota-se que os dados referêntes aos scores obtidos pelos idosos é similar para ambas as condições, muito embora os scores obtidos pelos idosos sem patologia seja em média superior porém com um desvio padrão também maior. Outro fator importante é que ambas as distribuições são relativamente simétricas diferindo cum pouco quanto a curtose. O coeficiênte de variação apresenta uma ligeira diferença que associada às diferentes médias pode siginificar um comportamento destinto dos dois grupos.


## Modelo 
Com base nos dados é possível avaliar um modelo de regressão logistico.


```{r}
#| echo: false
#| warning: false

fit_l <- glm(resp~score, data=dados, family = binomial(link="logit"))
anova_l <- anova(fit_l)
rownames(anova_l) <- c("Intercepto", "Beta 1")
parametros_l <- confint(fit_l)
anova_l <- round(anova_l,3)
anova_l %>%
  kbl(
    caption = "Resultados da ANOVA, para o modelo com função de ligação logito.",
    digits = 4,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", 
    row.names = T,
  ) %>%
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "repeat_header")
  )|>
  column_spec(1, bold = T
  )|>
  kable_material()
```

```{r }
#| echo: false
#| warning: false

fit_p <- glm(resp~score, data=dados, family = binomial(link="probit"))
anova_p <- anova(fit_p)
rownames(anova_p) <- c("Intercepto", "Beta 1")
parametros_p <- confint(fit_p)
anova_p <- round(anova_p,3)
anova_p %>%
  kbl(
    caption = "Resultados da ANOVA, para o modelo com função de ligação probito.",
    digits = 4,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", 
    row.names = T,
  ) %>%
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "repeat_header")
  )|>
  column_spec(1, bold = T
  )|>
  kable_material()
```



```{r}
#| echo: false
#| warning: false

fit_c <- glm(resp~score, data=dados, family = binomial(link="cauchit"))
anova_c <- anova(fit_c)
rownames(anova_c) <- c("Intercepto", "Beta 1")
parametros_c <- confint(fit_c)
anova_c <- round(anova_c,3)
anova_c %>%
  kbl(
    caption = "Resultados da ANOVA, para o modelo com função de ligação cauchit.",
    digits = 4,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", 
    row.names = T,
  ) %>%
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "repeat_header")
  )|>
  column_spec(1, bold = T
  )|>
  kable_material()
```

Os modelos apresentados nas tabelas 2, 3 e 4 são bastante similares. Uma comparação mais acurada dos modelos pode ser verificada a partir dos valores de AIC atingidos. A Tabela 5 mostra esses valores.


```{r}
#| echo: false
#| warning: false

aic_l <- summary(fit_l)[5]
aic_p <- summary(fit_p)[5]
aic_c <- summary(fit_c)[5]
aic_l <- as.numeric(aic_l)
aic_p <- as.numeric(aic_p)
aic_c <- as.numeric(aic_c)
aic_l <- round(aic_l,4)
aic_p <- round(aic_p,4)
aic_c <- round(aic_c,4)

tab <- cbind(c("Logito", "Probito", "Cauchit"), c(aic_l,aic_p,aic_c))
colnames(tab) <- c("Função", "AIC")

tab %>%
  kbl(
    caption = "Valores de AIC dos modelos da ANOVA, para cada função de ligação.",
    digits = 4,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", 
    row.names = F,
  ) %>%
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "repeat_header")
  )|>
  column_spec(1, bold = T
  )|>
  kable_material()
```

Desta forma, verifica-se que a diferença entre os modelos é bastante sutil e não há necessidade de se valer de uma função de ligação diferente da canônica para explicar os dados. Assim a função de ligação logito é preferível dentre as demais.



## Resultados Inferenciais.

### Estimativas pontuais
Uma tabela contendo as estimativas dos parâmetros, erros padrões e p-valores. 

### Discussão dos resultados
Interpretação dos resultados. 

###Função Desvio
Interpretação da função desvio. 
Compare o valor da função desvio com a estatística qui-quadrado e interprete o resultado do teste de
hipótese.

### Gráficos
Apresente o gráfico da função de distribuição acumulada logística (veja Aula prática III - dados turbine). 
Plote o gráfico de $\hat z$ versus $\hat \eta$ e comente sobre as evidências de adequacidade da função de ligação.


###Análise Residual. 
Considerando os resíduos Studentizado (tsi) padronizado e o componente do desvio padronizado (tdi) apresente os seguintes gráficos tsi, tdi versus valores ajustados, tsi , tdi versus valores observados e os respectivos gráficos do envelope simulado.

### Observações Atípicas
Identifique as observações atípicas. Comente cada gráfico.
